:original_name: CreateFlowLog.html

.. _CreateFlowLog:

Creating a Flow Log
===================

Function
--------

This API is used to create a flow log for an enterprise router.

URI
---

POST /v3/{project_id}/enterprise-router/{er_id}/flow-logs

.. table:: **Table 1** Path Parameters

   ========== ========= ====== ====================
   Parameter  Mandatory Type   Description
   ========== ========= ====== ====================
   project_id Yes       String Project ID
   er_id      Yes       String Enterprise router ID
   ========== ========= ====== ====================

Request Parameters
------------------

.. table:: **Table 2** Request header parameters

   +-----------------+-----------------+-----------------+------------------------+
   | Parameter       | Mandatory       | Type            | Description            |
   +=================+=================+=================+========================+
   | X-Client-Token  | No              | String          | Idempotence identifier |
   |                 |                 |                 |                        |
   |                 |                 |                 | Minimum: **1**         |
   |                 |                 |                 |                        |
   |                 |                 |                 | Maximum: **64**        |
   +-----------------+-----------------+-----------------+------------------------+

.. table:: **Table 3** Request body parameters

   +-----------+-----------+----------------------------------------------------------------------+--------------------------------------+
   | Parameter | Mandatory | Type                                                                 | Description                          |
   +===========+===========+======================================================================+======================================+
   | flow_log  | Yes       | :ref:`FlowLogRequest <createflowlog__request_flowlogrequest>` object | Request body for creating a flow log |
   +-----------+-----------+----------------------------------------------------------------------+--------------------------------------+

.. _createflowlog__request_flowlogrequest:

.. table:: **Table 4** FlowLogRequest

   +-----------------+-----------------+-----------------+--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
   | Parameter       | Mandatory       | Type            | Description                                                                                                                                                                    |
   +=================+=================+=================+================================================================================================================================================================================+
   | name            | Yes             | String          | Flow log name                                                                                                                                                                  |
   |                 |                 |                 |                                                                                                                                                                                |
   |                 |                 |                 | Minimum: **1**                                                                                                                                                                 |
   |                 |                 |                 |                                                                                                                                                                                |
   |                 |                 |                 | Maximum: **64**                                                                                                                                                                |
   +-----------------+-----------------+-----------------+--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
   | description     | No              | String          | Flow log description                                                                                                                                                           |
   |                 |                 |                 |                                                                                                                                                                                |
   |                 |                 |                 | Minimum: **0**                                                                                                                                                                 |
   |                 |                 |                 |                                                                                                                                                                                |
   |                 |                 |                 | Maximum: **255**                                                                                                                                                               |
   +-----------------+-----------------+-----------------+--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
   | resource_type   | Yes             | String          | Type of resource whose flow logs are collected.                                                                                                                                |
   |                 |                 |                 |                                                                                                                                                                                |
   |                 |                 |                 | -  VPC attachments                                                                                                                                                             |
   |                 |                 |                 |                                                                                                                                                                                |
   |                 |                 |                 | -  Virtual gateway attachments                                                                                                                                                 |
   +-----------------+-----------------+-----------------+--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
   | resource_id     | Yes             | String          | Resource ID                                                                                                                                                                    |
   +-----------------+-----------------+-----------------+--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
   | log_group_id    | Yes             | String          | Log group ID. Obtain the log group ID by referring to the `Log Tank Service User Guide <https://docs.otc.t-systems.com/log-tank-service/umn/service_overview/index.html>`__.   |
   +-----------------+-----------------+-----------------+--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
   | log_stream_id   | Yes             | String          | Log stream ID. Obtain the log stream ID by referring to the `Log Tank Service User Guide <https://docs.otc.t-systems.com/log-tank-service/umn/service_overview/index.html>`__. |
   +-----------------+-----------------+-----------------+--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
   | log_store_type  | Yes             | String          | Flow log storage type.                                                                                                                                                         |
   |                 |                 |                 |                                                                                                                                                                                |
   |                 |                 |                 | LTS: Logs are stored on LTS servers.                                                                                                                                           |
   +-----------------+-----------------+-----------------+--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
   | log_store_name  | No              | String          | Flow log storage name. This parameter is not supported for now.                                                                                                                |
   |                 |                 |                 |                                                                                                                                                                                |
   |                 |                 |                 | Minimum: **1**                                                                                                                                                                 |
   |                 |                 |                 |                                                                                                                                                                                |
   |                 |                 |                 | Maximum: **255**                                                                                                                                                               |
   +-----------------+-----------------+-----------------+--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+

Response Parameters
-------------------

**Status code: 202**

.. table:: **Table 5** Response header parameters

   ============== ===== ======================
   Parameter      Type  Description
   ============== ===== ======================
   X-Client-Token ``-`` Idempotence identifier
   ============== ===== ======================

.. table:: **Table 6** Response body parameters

   +------------+---------------------------------------------------------+------------------+
   | Parameter  | Type                                                    | Description      |
   +============+=========================================================+==================+
   | flow_log   | :ref:`FlowLog <createflowlog__response_flowlog>` object | Flow log details |
   +------------+---------------------------------------------------------+------------------+
   | request_id | String                                                  | Request ID       |
   +------------+---------------------------------------------------------+------------------+

.. _createflowlog__response_flowlog:

.. table:: **Table 7** FlowLog

   +--------------------------+---------+----------------------------------------------------------------------------------------------------------------------+
   | Parameter                | Type    | Description                                                                                                          |
   +==========================+=========+======================================================================================================================+
   | id                       | String  | Flow log ID                                                                                                          |
   +--------------------------+---------+----------------------------------------------------------------------------------------------------------------------+
   | name                     | String  | Flow log name                                                                                                        |
   +--------------------------+---------+----------------------------------------------------------------------------------------------------------------------+
   | description              | String  | Flow log description                                                                                                 |
   +--------------------------+---------+----------------------------------------------------------------------------------------------------------------------+
   | project_id               | String  | Project ID of the flow log task creator                                                                              |
   +--------------------------+---------+----------------------------------------------------------------------------------------------------------------------+
   | resource_type            | String  | Resource type. The value is **attachment**.                                                                          |
   +--------------------------+---------+----------------------------------------------------------------------------------------------------------------------+
   | resource_id              | String  | Resource ID                                                                                                          |
   +--------------------------+---------+----------------------------------------------------------------------------------------------------------------------+
   | log_group_id             | String  | Log group ID                                                                                                         |
   +--------------------------+---------+----------------------------------------------------------------------------------------------------------------------+
   | log_stream_id            | String  | Log stream ID                                                                                                        |
   +--------------------------+---------+----------------------------------------------------------------------------------------------------------------------+
   | log_store_type           | String  | Flow log storage type. LTS is used for log storage.                                                                  |
   +--------------------------+---------+----------------------------------------------------------------------------------------------------------------------+
   | log_store_name           | String  | Flow log storage name. This parameter is not supported for now.                                                      |
   +--------------------------+---------+----------------------------------------------------------------------------------------------------------------------+
   | log_aggregation_interval | Integer | Log aggregation time, in seconds. The value ranges from **60** to **600**.                                           |
   +--------------------------+---------+----------------------------------------------------------------------------------------------------------------------+
   | created_at               | String  | Creation time in the format YYYY-MM-DDTHH:mm:ss.sssZ                                                                 |
   +--------------------------+---------+----------------------------------------------------------------------------------------------------------------------+
   | updated_at               | String  | Update time in the format YYYY-MM-DDTHH:mm:ss.sssZ                                                                   |
   +--------------------------+---------+----------------------------------------------------------------------------------------------------------------------+
   | state                    | String  | Flow log status. Value options: **pending**, **available**, **modifying**, **deleting**, **deleted**, and **failed** |
   +--------------------------+---------+----------------------------------------------------------------------------------------------------------------------+
   | enabled                  | Boolean | Whether to enable flow logs. The value can be **true** or **false**.                                                 |
   +--------------------------+---------+----------------------------------------------------------------------------------------------------------------------+

Example Requests
----------------

Creating a flow log

.. code-block:: text

   POST https://{erouter_endpoint}/v3/0605767a9980d5762fbcc00b3537e757/enterprise-router/a43c55e9-4911-4030-90e1-5c2bf6ae6fe2/flow-logs

   {
     "flow_log" : {
       "name" : "flow-log",
       "description" : "flow log test",
       "resource_type" : "attachment",
       "resource_id" : "6f83b848-8331-4271-ac0c-ef94b7686402",
       "log_group_id" : "0139393c-eeb2-49f0-bbd4-c5faec6b1497",
       "log_stream_id" : "d22c3b44-2f71-470f-83f3-96a8af6956ad",
       "log_store_type" : "LTS"
     }
   }

Example Responses
-----------------

**Status code: 202**

Accepted

.. code-block::

   {
     "flow_log" : {
       "id" : "b216bc1d-5963-41a7-89f9-779a5128c5ac",
       "name" : "flow_log",
       "project_id" : "0605767a9980d5762fbcc00b3537e757",
       "resource_type" : "attachment",
       "resource_id" : "6f83b848-8331-4271-ac0c-ef94b7686402",
       "log_group_id" : "0139393c-eeb2-49f0-bbd4-c5faec6b1497",
       "log_stream_id" : "d22c3b44-2f71-470f-83f3-96a8af6956ad",
       "log_store_type" : "LTS",
       "log_aggregation_interval" : 600,
       "created_at" : "2020-03-11T15:13:31Z",
       "updated_at" : "2022-03-11T15:13:31Z",
       "state" : "available",
       "enabled" : true,
       "description" : "Flow Logs"
     },
     "request_id" : "915a14a6-867b-4af7-83d1-70efceb146f9"
   }

Status Codes
------------

=========== ===========
Status Code Description
=========== ===========
202         Accepted
=========== ===========

Error Codes
-----------

See :ref:`Error Codes <errorcode>`.
